<div class="page-container">

  <!-- HEADER -->
  <div class="page-header">
    <h2>Exit Ticket</h2>
  </div>

  <!-- SEARCH CARD -->
  <div class="card">

    <form class="form-grid" (ngSubmit)="searchTicket()">

      <label>
        Plate Number
        <input
          type="text"
          [(ngModel)]="searchPlate"
          name="plate"
          placeholder="AA452ZB"
        />
      </label>

      <label>
        Ticket ID (optional)
        <input
          type="text"
          [(ngModel)]="searchTicketId"
          name="ticketId"
          placeholder="0000-0000..."
        />
      </label>

      <button
        type="submit"
        class="btn"
        [disabled]="loading || (!searchPlate && !searchTicketId)"
      >
        Search
      </button>

    </form>

    <p class="error" *ngIf="errorMsg">{{ errorMsg }}</p>
    <p class="success" *ngIf="successMsg">{{ successMsg }}</p>
  </div>

  <!-- TICKET FOUND -->
  <div class="card" *ngIf="foundTicket">

    <h3>Ticket Found</h3>

    <p><strong>Plate:</strong> {{ foundTicket.vehicle.plate }}</p>
    <p><strong>Spot:</strong> {{ foundTicket.spotCode }}</p>
    <p>
      <strong>Entry Time:</strong>
      {{ foundTicket.entryTime | date:'HH:mm dd/MM/yyyy' }}
    </p>

    <button
      class="btn"
      (click)="previewExit()"
      [disabled]="loading"
    >
      Preview Exit Fee
    </button>
  </div>

  <!-- PREVIEW RESULT -->
  <div class="card" *ngIf="preview">

    <h3>Exit Preview</h3>

    <p><strong>Duration:</strong> {{ preview.durationMinutes }} minutes</p>
    <p><strong>Billing Periods:</strong> {{ preview.billingPeriods }}</p>
    <p>
      <strong>Fee:</strong>
      <span class="badge badge--orange">
        {{ preview.appliedFee }} EUR
      </span>
    </p>

    <label>
      Payment Method
      <select [(ngModel)]="paymentMethod" name="payment">
        <option [ngValue]="0">Cash</option>
        <option [ngValue]="1">Card</option>
        <option [ngValue]="2">Other</option>
      </select>
    </label>

    <label class="lostTicket">
      <input
        type="checkbox"
        [(ngModel)]="isLostTicket"
        name="lost"
        (change)="previewExit()"
      />
      Lost Ticket
    </label>

    <button
      class="btn btn--danger"
      (click)="closeTicket()"
      [disabled]="loading"
    >
      Close & Pay
    </button>

  </div>

</div>
